@using System.Linq
@model FeatureTreeViewModel

@{
    var feature = Model.Feature;
    var children = Model.AllFeatures
        .Where(child => child.ParentFeatureId == feature.Id)
        .OrderBy(child => child.Title)
        .ToList();
}

<div class="feature-node" data-feature-id="@feature.Id" data-depth="@Model.Depth">
    <label class="feature-label">
        <input type="checkbox"
               name="SelectedFeatureIds"
               value="@feature.Id"
               class="feature-checkbox"
               data-feature-id="@feature.Id"
               data-parent-id="@(feature.ParentFeatureId?.ToString() ?? string.Empty)"
               data-depth="@Model.Depth" />
        <span class="feature-title">@feature.Title</span>
    </label>

    @if (!string.IsNullOrWhiteSpace(feature.Description))
    {
        <p class="feature-description">@feature.Description</p>
    }

    @if (children.Any())
    {
        <div class="feature-children" data-parent-id="@feature.Id">
            @foreach (var child in children)
            {
                @await Html.PartialAsync("_FeatureTree", new FeatureTreeViewModel(child, Model.AllFeatures, Model.Depth + 1))
            }
        </div>
    }
</div>
